<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>3. Advanced Topics &mdash; Py4J</title>
    <link rel="stylesheet" href="_static/py4jdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.8.1',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  'true'
      };
    </script>
    <script type="text/javascript" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="top" title="Py4J" href="index.html" />
    <link rel="next" title="4. Py4J Python API" href="py4j_python.html" />
    <link rel="prev" title="2. Getting Started with Py4J" href="getting_started.html" />
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-60501623-4', 'auto');
        ga('send', 'pageview');

    </script> 
  </head>
  <body>
  	<div class="page">
<div class="banner">Py4J - A Bridge between Python and Java</div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 5px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="py4j_python.html" title="4. Py4J Python API"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="getting_started.html" title="2. Getting Started with Py4J"
             accesskey="P">previous</a> |</li>
    <li><a href="index.html">Home</a> |</li>
	<li><a href="download.html">Download</a> |</li>
	<li><a href="contents.html">Doc</a> |</li>
	<li><a href="https://blog.py4j.org">Blog</a> |</li>
	<li><a href="https://github.com/bartdag/py4j">github</a> |</li>
	<li><a href="about.html">About</a> &raquo;</li>
 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="contents.html">On This Page</a></h3>
            <ul>
<li><a class="reference internal" href="#">3. Advanced Topics</a><ul>
<li><a class="reference internal" href="#accessing-java-collections-and-arrays-from-python">3.1. Accessing Java collections and arrays from Python</a><ul>
<li><a class="reference internal" href="#array">3.1.1. Array</a></li>
<li><a class="reference internal" href="#list">3.1.2. List</a></li>
<li><a class="reference internal" href="#set">3.1.3. Set</a></li>
<li><a class="reference internal" href="#map">3.1.4. Map</a></li>
</ul>
</li>
<li><a class="reference internal" href="#byte-array-byte">3.2. Byte array (byte[])</a></li>
<li><a class="reference internal" href="#implementing-java-interfaces-from-python-callback">3.3. Implementing Java interfaces from Python (callback)</a></li>
<li><a class="reference internal" href="#using-single-threading-model-pinned-thread">3.4. Using Single Threading Model (pinned thread)</a><ul>
<li><a class="reference internal" href="#the-multi-threading-model">3.4.1. The multi threading model</a></li>
<li><a class="reference internal" href="#the-single-threading-model">3.4.2. The single threading model</a></li>
</ul>
</li>
<li><a class="reference internal" href="#initiating-the-communication-from-the-java-side">3.5. Initiating the communication from the Java side</a><ul>
<li><a class="reference internal" href="#using-the-traditional-javagateway-gatewayserver">3.5.1. Using the traditional JavaGateway/GatewayServer</a></li>
<li><a class="reference internal" href="#using-clientserver">3.5.2. Using ClientServer</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-py4j-without-pre-determined-ports-dynamic-port-number">3.6. Using Py4J without pre-determined ports (dynamic port number)</a></li>
<li><a class="reference internal" href="#converting-python-collections-to-java-collections">3.7. Converting Python collections to Java Collections</a></li>
<li><a class="reference internal" href="#py4j-exceptions">3.8. Py4J Exceptions</a></li>
<li><a class="reference internal" href="#importing-packages-with-jvm-views">3.9. Importing packages with JVM Views</a></li>
<li><a class="reference internal" href="#using-py4j-with-eclipse">3.10. Using Py4J with Eclipse</a></li>
<li><a class="reference internal" href="#listening-to-server-events">3.11. Listening to server events</a></li>
<li><a class="reference internal" href="#py4j-memory-model">3.12. Py4J Memory model</a></li>
<li><a class="reference internal" href="#py4j-threading-and-connection-model">3.13. Py4J Threading and connection model</a></li>
<li><a class="reference internal" href="#tls">3.14. TLS</a></li>
<li><a class="reference internal" href="#authentication">3.15. Authentication</a></li>
<li><a class="reference internal" href="#boxing">3.16. Boxing</a></li>
<li><a class="reference internal" href="#performance">3.17. Performance</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="getting_started.html"
                                  title="previous chapter"><span class="section-number">2. </span>Getting Started with Py4J</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="py4j_python.html"
                                  title="next chapter"><span class="section-number">4. </span>Py4J Python API</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/advanced_topics.rst.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <section id="advanced-topics">
<h1><span class="section-number">3. </span>Advanced Topics<a class="headerlink" href="#advanced-topics" title="Permalink to this headline">¶</a></h1>
<section id="accessing-java-collections-and-arrays-from-python">
<h2><span class="section-number">3.1. </span>Accessing Java collections and arrays from Python<a class="headerlink" href="#accessing-java-collections-and-arrays-from-python" title="Permalink to this headline">¶</a></h2>
<p>Java collections are automatically mapped to Python collections so that
standard Python operations such as slicing work on Java collections. Here is
the mapping of the collection:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 22%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Java Collection</p></th>
<th class="head"><p>Python Collection</p></th>
<th class="head"><p>Py4J Implementation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Array</p></td>
<td><p>Sequence <a class="footnote-reference brackets" href="#arraynote" id="id1">1</a></p></td>
<td><p><a class="reference internal" href="py4j_java_collections.html#py4j.java_collections.JavaArray" title="py4j.java_collections.JavaArray"><code class="xref py py-class docutils literal notranslate"><span class="pre">JavaArray</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>java.util.List</p></td>
<td><p>MutableSequence</p></td>
<td><p><a class="reference internal" href="py4j_java_collections.html#py4j.java_collections.JavaList" title="py4j.java_collections.JavaList"><code class="xref py py-class docutils literal notranslate"><span class="pre">JavaList</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p>java.util.Set</p></td>
<td><p>MutableSet</p></td>
<td><p><a class="reference internal" href="py4j_java_collections.html#py4j.java_collections.JavaSet" title="py4j.java_collections.JavaSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">JavaSet</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p>java.util.Map</p></td>
<td><p>MutableMapping</p></td>
<td><p><a class="reference internal" href="py4j_java_collections.html#py4j.java_collections.JavaMap" title="py4j.java_collections.JavaMap"><code class="xref py py-class docutils literal notranslate"><span class="pre">JavaMap</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p>java.util.Iterator</p></td>
<td><p><em>Iterator Protocol</em></p></td>
<td><p><a class="reference internal" href="py4j_java_collections.html#py4j.java_collections.JavaIterator" title="py4j.java_collections.JavaIterator"><code class="xref py py-class docutils literal notranslate"><span class="pre">JavaIterator</span></code></a></p></td>
</tr>
</tbody>
</table>
<dl class="footnote brackets">
<dt class="label" id="arraynote"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Py4J allows elements to be modified (like a real Java array), which is not the case of true
immutable sequences like tuples.</p>
</dd>
</dl>
<p>Java methods are still accessible when using the Python version of a Java
collection. Here are some usage examples for each collection class. These
examples do not cover the entire API.</p>
<p>It is possible to change this default mapping by registering an output
converter with <a class="reference internal" href="py4j_java_protocol.html#py4j.protocol.register_output_converter" title="py4j.protocol.register_output_converter"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_output_converter</span></code></a></p>
<section id="array">
<h3><span class="section-number">3.1.1. </span>Array<a class="headerlink" href="#array" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gateway</span> <span class="o">=</span> <span class="n">JavaGateway</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">int_class</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">int</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">int_array</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">new_array</span><span class="p">(</span><span class="n">int_class</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">int_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">int_array</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">int_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">int_array</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">IndexError</span>: <span class="n">list index out of range</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">int_array</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">1</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sarray</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">new_array</span><span class="p">(</span><span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="n">String</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">sarray</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">sarray</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sarray</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;hello&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sarray</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="go">u&#39;hello&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sarray</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span>
<span class="go">True</span>
</pre></div>
</div>
</section>
<section id="list">
<h3><span class="section-number">3.1.2. </span>List<a class="headerlink" href="#list" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">l</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">ArrayList</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># calling Python interface</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span> <span class="c1"># calling Java interface</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span> <span class="n">elem</span>
<span class="gp">...</span>
<span class="go">1</span>
<span class="go">hello</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
<span class="go">&quot;[2, u&#39;hello&#39;, 3]&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l2</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">999</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span>
<span class="go">[2, u&#39;hello&#39;, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l2</span> <span class="c1"># l2 is a copy of l and not a view so a change in l2 does not affect l</span>
<span class="go">[999, u&#39;hello&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">l</span>
<span class="go">[u&#39;hello&#39;, 3]</span>
</pre></div>
</div>
</section>
<section id="set">
<h3><span class="section-number">3.1.3. </span>Set<a class="headerlink" href="#set" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">HashSet</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span>
<span class="go">set([1, u&#39;hello&#39;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">1</span> <span class="ow">in</span> <span class="n">s</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span>
<span class="go">set([1])</span>
</pre></div>
</div>
</section>
<section id="map">
<h3><span class="section-number">3.1.4. </span>Map<a class="headerlink" href="#map" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">HashMap</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span>
<span class="go">{u&#39;a&#39;: 0, u&#39;b&#39;: 1}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="sa">u</span><span class="s2">&quot;b&quot;</span> <span class="ow">in</span> <span class="n">m</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span>
<span class="go">{u&#39;b&#39;: 1}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">m</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
<span class="gp">...</span>
<span class="go">b:1</span>
<span class="go">c:2</span>
</pre></div>
</div>
</section>
</section>
<section id="byte-array-byte">
<h2><span class="section-number">3.2. </span>Byte array (byte[])<a class="headerlink" href="#byte-array-byte" title="Permalink to this headline">¶</a></h2>
<p>Since version 0.7, Py4J automatically passes Java byte array (i.e., <cite>byte[]</cite>)
by value and convert them to Python bytearray (2.x) or bytes (3.x) and vice
versa. The rationale is that byte array are often used for binary processing
and are often immutable: a program reads a series of byte from a data source
and interpret it (or transform it into another byte array).</p>
<p>Prior to 0.7, a Python program could interact with a Java byte[] but each
access to a byte required a call between the Python and the Java interpreter
(i.e., the Python program only had a reference to the array).</p>
<p>In summary:</p>
<ul class="simple">
<li><p>If from Java, you return a byte[], Py4J will convert the byte[] to a
bytearray (Python 2.x) or bytes (Python 3.x) variable in Python.</p></li>
<li><p>If from Python, you pass a bytearray or bytes variable to the Java side,
Py4J will convert it to a byte[].</p></li>
<li><p>If you pass a byte[] from Java to Python, both arrays are disconnected: a
change to the array on one side will not be reflected on the other side.</p></li>
<li><p>If you want to pass an array by reference, use a <cite>Byte[]</cite> instead of a
<cite>byte[]</cite> or you can use  <a class="reference external" href="http://guava-libraries.googlecode.com/svn/trunk/javadoc/com/google/common/primitives/Bytes.html#asList(byte...)">Bytes.asList</a>
from <a class="reference external" href="http://code.google.com/p/guava-libraries/">Guava</a> to obtain a list
backed by a byte array.</p></li>
</ul>
</section>
<section id="implementing-java-interfaces-from-python-callback">
<h2><span class="section-number">3.3. </span>Implementing Java interfaces from Python (callback)<a class="headerlink" href="#implementing-java-interfaces-from-python-callback" title="Permalink to this headline">¶</a></h2>
<p>Since version 0.3, Py4J allows Python classes to implement Java interfaces so
that the JVM can call back Python objects. In the following example, a Python
class implements a Java listener interface.</p>
<p>Here is the code of listener interface:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// py4j/examples/ExampleListener.java</span>
<span class="kn">package</span> <span class="nn">py4j.examples</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ExampleListener</span> <span class="p">{</span>

    <span class="n">Object</span> <span class="nf">notify</span><span class="p">(</span><span class="n">Object</span> <span class="n">source</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Here is the code of the main Java application.  The program has a main method
starting a <cite>GatewayServer</cite>. The entry point, a <cite>ListenerApplication</cite> instance,
has two methods, one to register listeners, the other to notify all listeners.
Start this program before running the Python code below.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// py4j/examples/ListenerApplication.java</span>
<span class="kn">package</span> <span class="nn">py4j.examples</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">py4j.GatewayServer</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ListenerApplication</span> <span class="p">{</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">ExampleListener</span><span class="o">&gt;</span> <span class="n">listeners</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ExampleListener</span><span class="o">&gt;</span><span class="p">();</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">registerListener</span><span class="p">(</span><span class="n">ExampleListener</span> <span class="n">listener</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">listeners</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">listener</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">notifyAllListeners</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">ExampleListener</span> <span class="n">listener</span><span class="p">:</span> <span class="n">listeners</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">Object</span> <span class="n">returnValue</span> <span class="o">=</span> <span class="n">listener</span><span class="p">.</span><span class="na">notify</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">returnValue</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;&lt;ListenerApplication&gt; instance&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">ListenerApplication</span> <span class="n">application</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ListenerApplication</span><span class="p">();</span>
        <span class="n">GatewayServer</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GatewayServer</span><span class="p">(</span><span class="n">application</span><span class="p">);</span>
        <span class="n">server</span><span class="p">.</span><span class="na">start</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is the Python program that implements the Java interface and calls the
ListenerApplication to notify all listeners. Then multiple exchanges between
Java and Python occurs (e.g., Python calls System.out.println on the Java
side).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">py4j.java_gateway</span> <span class="kn">import</span> <span class="n">JavaGateway</span><span class="p">,</span> <span class="n">CallbackServerParameters</span>


<span class="k">class</span> <span class="nc">PythonListener</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gateway</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gateway</span> <span class="o">=</span> <span class="n">gateway</span>

    <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Notified by Java&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Hello from python!&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;A Return Value&quot;</span>

    <span class="k">class</span> <span class="nc">Java</span><span class="p">:</span>
        <span class="n">implements</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;py4j.examples.ExampleListener&quot;</span><span class="p">]</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">gateway</span> <span class="o">=</span> <span class="n">JavaGateway</span><span class="p">(</span>
        <span class="n">callback_server_parameters</span><span class="o">=</span><span class="n">CallbackServerParameters</span><span class="p">())</span>
    <span class="n">listener</span> <span class="o">=</span> <span class="n">PythonListener</span><span class="p">(</span><span class="n">gateway</span><span class="p">)</span>
    <span class="n">gateway</span><span class="o">.</span><span class="n">entry_point</span><span class="o">.</span><span class="n">registerListener</span><span class="p">(</span><span class="n">listener</span><span class="p">)</span>
    <span class="n">gateway</span><span class="o">.</span><span class="n">entry_point</span><span class="o">.</span><span class="n">notifyAllListeners</span><span class="p">()</span>
    <span class="n">gateway</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</pre></div>
</div>
<p>The <cite>PythonListener</cite> class is a standard Python class that has one method,
<cite>notify</cite>. The signature of the method contains one parameter. When interfaces
contain overloaded methods, the python method must accept all possible
combinations of parameters (with <cite>*args</cite> and <cite>**kwargs</cite> or with default
parameters).</p>
<p>Py4J recognizes that the <cite>PythonListener</cite> class implements a Java interface
because it declares an internal class called <cite>Java</cite>, which has a member named
<cite>implements</cite>. This member is a list of string representing the fully qualified
name of implemented Java interfaces.</p>
<p>Finally, the Python program contains a main method that starts a gateway,
initializes a PythonListener instance and registers it to the
<cite>ListenerApplication</cite> instance on the Java side. Then, it calls the
<cite>notifyAllListeners()</cite> method, which will notify all listeners. Py4J takes care
of creating the necessary proxies: the <cite>notify</cite> method of the <cite>PythonListener</cite>
class is called in the Java VM, but the method is executed in the Python
interpreter.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Python classes can only implement Java interfaces. Abstract or concrete
classes are not supported because Java does not natively support dynamic
proxies for classes. Extending classes may be supported in future releases
of Py4J.</p>
<p>As a workaround, a subclass of the abstract class could be created on the
Java side. The methods of the subclass would call the methods of a custom
interface that a Python class could implement.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you want to implement an interface declared in a class (i.e., an
internal class), you need to prefix the name of the interface with
a dollar sign. For example, if the interface <cite>Operator</cite> is declared
in the class <cite>package1.MyClass</cite>, you will have to write:</p>
<p><cite>implements = [‘package1.MyClass$Operator’]</cite></p>
</div>
</section>
<section id="using-single-threading-model-pinned-thread">
<span id="clientserver"></span><h2><span class="section-number">3.4. </span>Using Single Threading Model (pinned thread)<a class="headerlink" href="#using-single-threading-model-pinned-thread" title="Permalink to this headline">¶</a></h2>
<section id="the-multi-threading-model">
<h3><span class="section-number">3.4.1. </span>The multi threading model<a class="headerlink" href="#the-multi-threading-model" title="Permalink to this headline">¶</a></h3>
<p>When you use a <cite>JavaGateway</cite> and a <cite>CallbackServer</cite>, Py4J will create a new
thread every time a command <strong>is received</strong> and <strong>there is no thread
available</strong>.  This can lead to the creation of many threads if there are
recursive calls between Python and Java. For example, let’s consider this code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PythonPlayer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">player</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">player</span><span class="o">.</span><span class="n">firstPing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">firstPong</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">player</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">player</span><span class="o">.</span><span class="n">secondPing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">secondPong</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">player</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Success&quot;</span>

    <span class="k">class</span> <span class="nc">Java</span><span class="p">:</span>
        <span class="n">implements</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;py4j.examples.PongPlayer&quot;</span><span class="p">]</span>

<span class="c1"># Start the JVM with &quot;java -cp py4j.jar py4j.examples.ExampleApplication&quot;</span>
<span class="kn">from</span> <span class="nn">py4j.java_gateway</span> <span class="kn">import</span> <span class="n">JavaGateway</span><span class="p">,</span> <span class="n">CallbackServerParameters</span>
<span class="n">gateway</span> <span class="o">=</span> <span class="n">JavaGateway</span><span class="p">(</span>
    <span class="n">callback_server_parameters</span><span class="o">=</span><span class="n">CallbackServerParameters</span><span class="p">())</span>
<span class="n">ping_player</span> <span class="o">=</span> <span class="n">java_gateway</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">py4j</span><span class="o">.</span><span class="n">examples</span><span class="o">.</span><span class="n">PingPlayer</span><span class="p">()</span>
<span class="n">pong_player</span> <span class="o">=</span> <span class="n">PongPlayer</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pong_player</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">ping_player</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// PongPlayer.java</span>
<span class="kn">package</span> <span class="nn">py4j.examples</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PongPlayer</span> <span class="p">{</span>

    <span class="n">String</span> <span class="nf">firstPong</span><span class="p">(</span><span class="n">PingPlayer</span> <span class="n">player</span><span class="p">);</span>

    <span class="n">String</span> <span class="nf">secondPong</span><span class="p">(</span><span class="n">PingPlayer</span> <span class="n">player</span><span class="p">);</span>

<span class="p">}</span>

<span class="c1">// PingPlayer.java</span>
<span class="kn">package</span> <span class="nn">py4j.examples</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PingPlayer</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">firstPing</span><span class="p">(</span><span class="n">PongPlayer</span> <span class="n">player</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">player</span><span class="p">.</span><span class="na">firstPong</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">secondPing</span><span class="p">(</span><span class="n">PongPlayer</span> <span class="n">player</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">player</span><span class="p">.</span><span class="na">secondPong</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>When this code is executed, the Python side creates 2 threads and the
Java side creates two threads (note that the Java and Python sides both start
with an implicit thread so there are a minimum of three threads on either
side).</p>
<ol class="arabic simple">
<li><p>The Python client initiates the conversation by calling firstPing()
and waits for a response.</p></li>
<li><p>The Java server receives the call and creates Java Thread 1 to execute the
code. Java then calls firstPong and waits for a response.</p></li>
<li><p>The Python server receives the call and creates Python Thread 1 to execute
the code. Python then calls secondPing and waits for a response.</p></li>
<li><p>The Java server receives the call and creates Java Thread 2 to execute the
code. Java then calls secondPong and waits for a response.</p></li>
<li><p>The Python server receives the call and creates Python Thread 2 to execute
the code. Python then returns the response <code class="docutils literal notranslate"><span class="pre">&quot;Success&quot;</span></code>. Python Thread 2
can now be used to execute other calls.</p></li>
<li><p>Java Thread 2 (secondPing) receives a response and sends back the
response to the Python side. Java Thread 2 can now be used to execute other
calls.</p></li>
<li><p>Python Thread 1 (firstPong) receives a response and sends back the response
to the Java side. Python Thread 1 can now be used to execute other calls.</p></li>
<li><p>Java Thread 1 (firstPing) receives a response and sends back the response to
the Python side. Java Thread 1 can now be used to execute other calls.</p></li>
<li><p>The Python side receives the response and prints it.</p></li>
</ol>
</section>
<section id="the-single-threading-model">
<h3><span class="section-number">3.4.2. </span>The single threading model<a class="headerlink" href="#the-single-threading-model" title="Permalink to this headline">¶</a></h3>
<p>Although the multi threading model is sound and has been used by many
distributed systems (e.g., Java RMI), it has two main issues: (1) it creates a
lot of threads when the Java and Python sides exchange many calls such as when
there is indirect recursion between the two sides, and (2) it is not possible
to control in which thread the code will be executed. The first issue can
severely impact performance and the second issue limits the usefulness of Py4J
in certain applications (e.g., GUI applications).</p>
<p>To work around these limitations, the <a class="reference internal" href="py4j_client_server.html#module-py4j.clientserver" title="py4j.clientserver: Py4J single threading model implementation"><code class="xref py py-mod docutils literal notranslate"><span class="pre">py4j.clientserver</span></code></a> module
implements a single threading model also called <em>pinned thread model</em> that
ensures that callbacks received from the other side will be executed in the
initiating thread. For example, if we modify the previous code with this one:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start the JVM with &quot;java -cp py4j.jar py4j.examples.SingleThreadApplication&quot;</span>
<span class="kn">from</span> <span class="nn">py4j.clientserver</span> <span class="kn">import</span> <span class="n">ClientServer</span><span class="p">,</span> <span class="n">JavaParameters</span><span class="p">,</span> <span class="n">PythonParameters</span>
<span class="n">gateway</span> <span class="o">=</span> <span class="n">ClientServer</span><span class="p">(</span>
    <span class="n">java_parameters</span><span class="o">=</span><span class="n">JavaParameters</span><span class="p">(),</span>
    <span class="n">python_parameters</span><span class="o">=</span><span class="n">PythonParameters</span><span class="p">())</span>
<span class="n">ping_player</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">py4j</span><span class="o">.</span><span class="n">examples</span><span class="o">.</span><span class="n">PingPlayer</span><span class="p">()</span>
<span class="n">pong_player</span> <span class="o">=</span> <span class="n">PongPlayer</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pong_player</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">ping_player</span><span class="p">))</span>
</pre></div>
</div>
<p>Only one Java Thread will be created and no Python thread will be created:</p>
<ol class="arabic simple">
<li><p>The Python client initiates the conversation from Python Thread 1 by calling
firstPing() and waits for <strong>either a response or a call to execute</strong>.</p></li>
<li><p>The Java server receives the call and creates Java Thread 1 to execute the
code. Java then calls firstPong and waits for a response or a call to
execute.</p></li>
<li><p>Python Thread 1 receives the call and calls secondPing. It waits for a
response or a call.</p></li>
<li><p>Java Thread 1 receives the call and then call secondPong.  It waits for a
response or a call.</p></li>
<li><p>Python Thread 1 receives the call responds with <code class="docutils literal notranslate"><span class="pre">&quot;Success&quot;</span></code>.</p></li>
<li><p>Java Thread 1 (secondPing) receives the response and sends the response to the Python
side.</p></li>
<li><p>Python Thread 1 (firstPong) receives the response and sends the response to
the Java side.</p></li>
<li><p>Java Thread 1 (firstPing) receives the response and sends the response to
the Python side.</p></li>
<li><p>Python Thread 1 (start) receives the response and prints it.</p></li>
</ol>
<p>In total, only one thread was created (on the Java side). If for whatever
reason multiple threads are created on the Python side and they each call the
Java side, a corresponding Java thread will be created. For example, if three
threads from the Python side are calling the Java side, three Java threads will
be created.</p>
</section>
</section>
<section id="initiating-the-communication-from-the-java-side">
<span id="python-entry-point"></span><h2><span class="section-number">3.5. </span>Initiating the communication from the Java side<a class="headerlink" href="#initiating-the-communication-from-the-java-side" title="Permalink to this headline">¶</a></h2>
<p>All the previous examples assume that you want to initiate the communication
between Python and Java from the Python side. What if you want to start calling
Python from the Java side?</p>
<p>If you want Java to call Python first, you need to:</p>
<ol class="arabic simple">
<li><p>Start the Python process and create either a JavaGateway or a ClientServer.</p></li>
<li><p>Pass a Python instance implementing a Java interface as a
<code class="docutils literal notranslate"><span class="pre">python_server_entry_point</span></code> parameter.</p></li>
<li><p>Start a GatewayServer or ClientServer on the Java side.</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">getPythonServerEntryPoint</span></code> by providing the list of interfaces the
Python entry point is expected to implement.</p></li>
</ol>
<section id="using-the-traditional-javagateway-gatewayserver">
<h3><span class="section-number">3.5.1. </span>Using the traditional JavaGateway/GatewayServer<a class="headerlink" href="#using-the-traditional-javagateway-gatewayserver" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// IHello.java</span>
<span class="kn">package</span> <span class="nn">py4j.examples</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IHello</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">sayHello</span><span class="p">();</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">sayHello</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">String</span> <span class="n">s</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ExampleClientApplication.java</span>
<span class="kn">package</span> <span class="nn">py4j.examples</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">py4j.GatewayServer</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExampleClientApplication</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">GatewayServer</span><span class="p">.</span><span class="na">turnLoggingOff</span><span class="p">();</span>
          <span class="n">GatewayServer</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GatewayServer</span><span class="p">();</span>
          <span class="n">server</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
          <span class="n">IHello</span> <span class="n">hello</span> <span class="o">=</span> <span class="p">(</span><span class="n">IHello</span><span class="p">)</span> <span class="n">server</span><span class="p">.</span><span class="na">getPythonServerEntryPoint</span><span class="p">(</span><span class="k">new</span> <span class="n">Class</span><span class="o">[]</span> <span class="p">{</span> <span class="n">IHello</span><span class="p">.</span><span class="na">class</span> <span class="p">});</span>
          <span class="k">try</span> <span class="p">{</span>
              <span class="n">hello</span><span class="p">.</span><span class="na">sayHello</span><span class="p">();</span>
              <span class="n">hello</span><span class="p">.</span><span class="na">sayHello</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;Hello World&quot;</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
          <span class="p">}</span>
          <span class="n">server</span><span class="p">.</span><span class="na">shutdown</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SimpleHello</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">sayHello</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">int_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">string_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">int_value</span><span class="p">,</span> <span class="n">string_value</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;Said hello to </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string_value</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Java</span><span class="p">:</span>
        <span class="n">implements</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;py4j.examples.IHello&quot;</span><span class="p">]</span>

<span class="c1"># Make sure that the python code is started first.</span>
<span class="c1"># Then execute: java -cp py4j.jar py4j.examples.SingleThreadClientApplication</span>
<span class="kn">from</span> <span class="nn">py4j.java_gateway</span> <span class="kn">import</span> <span class="n">JavaGateway</span><span class="p">,</span> <span class="n">CallbackServerParameters</span>
<span class="n">simple_hello</span> <span class="o">=</span> <span class="n">SimpleHello</span><span class="p">()</span>
<span class="n">gateway</span> <span class="o">=</span> <span class="n">JavaGateway</span><span class="p">(</span>
    <span class="n">callback_server_parameters</span><span class="o">=</span><span class="n">CallbackServerParameters</span><span class="p">(),</span>
    <span class="n">python_server_entry_point</span><span class="o">=</span><span class="n">simple_hello</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="using-clientserver">
<h3><span class="section-number">3.5.2. </span>Using ClientServer<a class="headerlink" href="#using-clientserver" title="Permalink to this headline">¶</a></h3>
<p>In the following example, the Java side is initiating the conversation by
making the first call to the Python side. If the call is initiated from a UI
thread, then all subsequent call from Python to Java will be executed in the
Java UI thread.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// IHello.java</span>
<span class="kn">package</span> <span class="nn">py4j.examples</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IHello</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">sayHello</span><span class="p">();</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">sayHello</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">String</span> <span class="n">s</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// SingleThreadClientApplication.java</span>
<span class="kn">package</span> <span class="nn">py4j.examples</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">py4j.ClientServer</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">py4j.GatewayServer</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SingleThreadClientApplication</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">ClientServer</span> <span class="n">clientServer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClientServer</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
        <span class="c1">// We get an entry point from the Python side</span>
        <span class="n">IHello</span> <span class="n">hello</span> <span class="o">=</span> <span class="p">(</span><span class="n">IHello</span><span class="p">)</span> <span class="n">clientServer</span><span class="p">.</span><span class="na">getPythonServerEntryPoint</span><span class="p">(</span><span class="k">new</span> <span class="n">Class</span><span class="o">[]</span> <span class="p">{</span> <span class="n">IHello</span><span class="p">.</span><span class="na">class</span> <span class="p">});</span>
        <span class="c1">// Java calls Python without ever having been called from Python</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">hello</span><span class="p">.</span><span class="na">sayHello</span><span class="p">());</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">hello</span><span class="p">.</span><span class="na">sayHello</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;Hello World&quot;</span><span class="p">));</span>
        <span class="n">clientServer</span><span class="p">.</span><span class="na">shutdown</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SimpleHello</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">sayHello</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">int_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">string_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">int_value</span><span class="p">,</span> <span class="n">string_value</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;Said hello to </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string_value</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Java</span><span class="p">:</span>
        <span class="n">implements</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;py4j.examples.IHello&quot;</span><span class="p">]</span>

<span class="c1"># Make sure that the python code is started first.</span>
<span class="c1"># Then execute: java -cp py4j.jar py4j.examples.SingleThreadClientApplication</span>
<span class="kn">from</span> <span class="nn">py4j.clientserver</span> <span class="kn">import</span> <span class="n">ClientServer</span><span class="p">,</span> <span class="n">JavaParameters</span><span class="p">,</span> <span class="n">PythonParameters</span>
<span class="n">simple_hello</span> <span class="o">=</span> <span class="n">SimpleHello</span><span class="p">()</span>
<span class="n">gateway</span> <span class="o">=</span> <span class="n">ClientServer</span><span class="p">(</span>
    <span class="n">java_parameters</span><span class="o">=</span><span class="n">JavaParameters</span><span class="p">(),</span>
    <span class="n">python_parameters</span><span class="o">=</span><span class="n">PythonParameters</span><span class="p">(),</span>
    <span class="n">python_server_entry_point</span><span class="o">=</span><span class="n">simple_hello</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="using-py4j-without-pre-determined-ports-dynamic-port-number">
<span id="dynamic-ports"></span><h2><span class="section-number">3.6. </span>Using Py4J without pre-determined ports (dynamic port number)<a class="headerlink" href="#using-py4j-without-pre-determined-ports-dynamic-port-number" title="Permalink to this headline">¶</a></h2>
<p>If you do not want to use Py4J’s default port (25333 on the Java side and 25334
on the Python side to receive callback), you can use the port 0 and Py4J will
use the next available port. Once a port is assigned, the other side needs to
be aware of this port. Here is one way to do it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">py4j.java_gateway</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">JavaGateway</span><span class="p">,</span> <span class="n">CallbackServerParameters</span><span class="p">,</span> <span class="n">GatewayParameters</span><span class="p">,</span>
    <span class="n">launch_gateway</span><span class="p">)</span>
<span class="c1"># launch Java side with dynamic port and get back the port on which the</span>
<span class="c1"># server was bound to.</span>
<span class="n">port</span> <span class="o">=</span> <span class="n">launch_gateway</span><span class="p">()</span>

<span class="c1"># connect python side to Java side with Java dynamic port and start python</span>
<span class="c1"># callback server with a dynamic port</span>
<span class="n">gateway</span> <span class="o">=</span> <span class="n">JavaGateway</span><span class="p">(</span>
    <span class="n">gateway_parameters</span><span class="o">=</span><span class="n">GatewayParameters</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">),</span>
    <span class="n">callback_server_parameters</span><span class="o">=</span><span class="n">CallbackServerParameters</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="c1"># retrieve the port on which the python callback server was bound to.</span>
<span class="n">python_port</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">get_callback_server</span><span class="p">()</span><span class="o">.</span><span class="n">get_listening_port</span><span class="p">()</span>

<span class="c1"># tell the Java side to connect to the python callback server with the new</span>
<span class="c1"># python port. Note that we use the java_gateway_server attribute that</span>
<span class="c1"># retrieves the GatewayServer instance.</span>
<span class="n">gateway</span><span class="o">.</span><span class="n">java_gateway_server</span><span class="o">.</span><span class="n">resetCallbackClient</span><span class="p">(</span>
    <span class="n">gateway</span><span class="o">.</span><span class="n">java_gateway_server</span><span class="o">.</span><span class="n">getCallbackClient</span><span class="p">()</span><span class="o">.</span><span class="n">getAddress</span><span class="p">(),</span>
    <span class="n">python_port</span><span class="p">)</span>

<span class="c1"># Test that callbacks work</span>
<span class="kn">from</span> <span class="nn">py4j.tests.java_callback_test</span> <span class="kn">import</span> <span class="n">IHelloImpl</span>
<span class="n">hello</span> <span class="o">=</span> <span class="n">IHelloImpl</span><span class="p">()</span>
<span class="n">example</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">py4j</span><span class="o">.</span><span class="n">examples</span><span class="o">.</span><span class="n">ExampleClass</span><span class="p">()</span>
<span class="n">example</span><span class="o">.</span><span class="n">callHello</span><span class="p">(</span><span class="n">hello</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="converting-python-collections-to-java-collections">
<span id="collections-conversion"></span><h2><span class="section-number">3.7. </span>Converting Python collections to Java Collections<a class="headerlink" href="#converting-python-collections-to-java-collections" title="Permalink to this headline">¶</a></h2>
<p>If you try to pass a Python collection to a method that expects a Java
collection, an error will be thrown:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Collections</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">my_list</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
  File <span class="nb">&quot;py4j/java_gateway.py&quot;</span>, line <span class="m">347</span>, in <span class="n">__call__</span>
    <span class="n">args_command</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">get_command_part</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">new_args</span><span class="p">])</span>
  File <span class="nb">&quot;py4j/protocol.py&quot;</span>, line <span class="m">195</span>, in <span class="n">get_command_part</span>
    <span class="n">command_part</span> <span class="o">=</span> <span class="n">REFERENCE_TYPE</span> <span class="o">+</span> <span class="n">parameter</span><span class="o">.</span><span class="n">_get_object_id</span><span class="p">()</span>
<span class="gr">AttributeError</span>: <span class="n">&#39;list&#39; object has no attribute &#39;_get_object_id&#39;</span>
</pre></div>
</div>
<p>You can explicitly convert Python collections using one of the following
converter located in the <cite>py4j.java_collections</cite> module: <cite>SetConverter</cite>,
<cite>MapConverter</cite>, <cite>ListConverter</cite>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py4j.java_collections</span> <span class="kn">import</span> <span class="n">SetConverter</span><span class="p">,</span> <span class="n">MapConverter</span><span class="p">,</span> <span class="n">ListConverter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">java_list</span> <span class="o">=</span> <span class="n">ListConverter</span><span class="p">()</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">my_list</span><span class="p">,</span> <span class="n">gateway</span><span class="o">.</span><span class="n">_gateway_client</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Collections</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">java_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">java_list</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_list</span>
<span class="go">[3, 2, 1]</span>
</pre></div>
</div>
<p>Note that the Python list is totally disconnected from the Java list. The Java
List is actually a copy. You can also ask Py4J to automatically convert Python
collections to Java Collections when calling a Java method: just set
<code class="docutils literal notranslate"><span class="pre">auto_convert=True</span></code> when creating a <cite>JavaGateway</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gateway</span> <span class="o">=</span> <span class="n">JavaGateway</span><span class="p">(</span><span class="n">gateway_parameters</span><span class="o">=</span><span class="n">GatewayParameters</span><span class="p">(</span><span class="n">auto_convert</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_list</span>
<span class="go">[3, 2, 1]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Collections</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">my_list</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_list</span> <span class="c1"># The python list is not sorted!</span>
<span class="go">[3, 2, 1]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">Collections</span><span class="o">.</span><span class="n">frequency</span><span class="p">(</span><span class="n">my_list</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
<p>Again, note that my_list is not sorted because when calling
<cite>Collections.sort()</cite>, Py4J only makes a copy of the Python list. Still, a copy
can be useful if you do not expect the list to be modified by the Java method
like in the call to <code class="docutils literal notranslate"><span class="pre">frequency()</span></code>.</p>
<p><strong>Order of Automatic Conversion</strong></p>
<p>When <code class="docutils literal notranslate"><span class="pre">auto_convert=True</span></code>, Py4J will attempt to automatically convert Python
objects that are not an instance of <code class="docutils literal notranslate"><span class="pre">basestring</span></code> or <code class="docutils literal notranslate"><span class="pre">JavaObject</span></code>. By
default, Py4J performs the following checks and conversions:</p>
<ol class="arabic simple">
<li><p>If the Python object is an instance of <cite>collections.Set</cite>, it is converted to
a <cite>HashSet</cite>.</p></li>
<li><p>If the object has the methods <cite>keys()</cite> and <cite>__getitem__</cite>, it is converted to
a <cite>HashMap</cite></p></li>
<li><p>If the object is iterable, it is converted to an <cite>ArrayList</cite>.</p></li>
<li><p>Otherwise, standard Py4J primitive type conversion is attempted (e.g., bool to boolean).</p></li>
</ol>
<p>It is possible to add custom converters by calling
<a class="reference internal" href="py4j_java_protocol.html#py4j.protocol.register_input_converter" title="py4j.protocol.register_input_converter"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_input_converter()</span></code></a>. Look at the source code of the
default converters for an example. Note that automatic conversion makes calling
Java methods slightly less efficient because in the worst case, Py4J needs to
go through all registered converters for all parameters. This is why automatic
conversion is disabled by default.</p>
</section>
<section id="py4j-exceptions">
<span id="id2"></span><h2><span class="section-number">3.8. </span>Py4J Exceptions<a class="headerlink" href="#py4j-exceptions" title="Permalink to this headline">¶</a></h2>
<p>Py4J can raise three exceptions on the Python side:</p>
<ul class="simple">
<li><p><a class="reference internal" href="py4j_java_protocol.html#py4j.protocol.Py4JJavaError" title="py4j.protocol.Py4JJavaError"><code class="xref py py-class docutils literal notranslate"><span class="pre">Py4JJavaError</span></code></a>. This exception is
raised when an exception occurs in the Java client code. For example, if you
try to pop an element from an empty stack. The instance of the Java exception
thrown is stored in the <cite>java_exception</cite> member.</p></li>
<li><p><a class="reference internal" href="py4j_java_protocol.html#py4j.protocol.Py4JNetworkError" title="py4j.protocol.Py4JNetworkError"><code class="xref py py-class docutils literal notranslate"><span class="pre">Py4JNetworkError</span></code></a>. This exception is
raised when a problem occurs during network transfer (e.g., connection lost).</p></li>
<li><p><a class="reference internal" href="py4j_java_protocol.html#py4j.protocol.Py4JError" title="py4j.protocol.Py4JError"><code class="xref py py-class docutils literal notranslate"><span class="pre">Py4JError</span></code></a>. This exception is raised when
any other error occurs such as when the client program tries to access an
object that no longer exists on the Java side.</p></li>
</ul>
<p>Both <cite>Py4JJavaError</cite> and <cite>Py4JNetworkError</cite> inherits from <cite>Py4JError</cite> so it is
possible to catch all related Py4J errors with one except clause:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
  <span class="n">java_object</span><span class="o">.</span><span class="n">doSomething</span><span class="p">()</span>
<span class="k">except</span> <span class="n">Py4JError</span><span class="p">:</span>
  <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</pre></div>
</div>
<p>If a Py4J Exception wraps another exception, the original exception will be
available in the <code class="docutils literal notranslate"><span class="pre">clause</span></code> field.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
  <span class="n">java_object</span><span class="o">.</span><span class="n">doSomething</span><span class="p">()</span>
<span class="k">except</span> <span class="n">Py4JError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
  <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">cause</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">cause</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="importing-packages-with-jvm-views">
<span id="jvm-views"></span><h2><span class="section-number">3.9. </span>Importing packages with JVM Views<a class="headerlink" href="#importing-packages-with-jvm-views" title="Permalink to this headline">¶</a></h2>
<p>Py4J allows you to import packages so that you don’t have to type the fully
qualified name of the classes you want to instantiate. The <cite>java.lang</cite> package
is always automatically imported.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py4j.java_gateway</span> <span class="kn">import</span> <span class="n">JavaGateway</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gateway</span> <span class="o">=</span> <span class="n">JavaGateway</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py4j.java_gateway</span> <span class="kn">import</span> <span class="n">java_import</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">java_import</span><span class="p">(</span><span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span><span class="p">,</span><span class="s1">&#39;java.util.*&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">jList</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">ArrayList</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">jMap</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">HashMap</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
<span class="go">u&#39;a&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
<span class="go">u&#39;a&#39;</span>
</pre></div>
</div>
<p>As opposed to Java where import statements do not cross compilation units (java
source files), the jvm instance can be shared across multiple Python modules: in
other words, import statements are global.</p>
<p>The recommended way to use import statements is to use one <a class="reference internal" href="py4j_java_gateway.html#py4j.java_gateway.JVMView" title="py4j.java_gateway.JVMView"><code class="xref py py-class docutils literal notranslate"><span class="pre">JVMView</span></code></a> instance per Python module. Here is an example on
how to create and use a <cite>JVMView</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">module1_view</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">new_jvm_view</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">module2_view</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">new_jvm_view</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">jList2</span> <span class="o">=</span> <span class="n">module1_view</span><span class="o">.</span><span class="n">ArrayList</span><span class="p">()</span>
<span class="go">Py4JError: Trying to call a package.</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">java_import</span><span class="p">(</span><span class="n">module1_view</span><span class="p">,</span><span class="s1">&#39;java.util.ArrayList&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">jList2</span> <span class="o">=</span> <span class="n">module1_view</span><span class="o">.</span><span class="n">ArrayList</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">jList3</span> <span class="o">=</span> <span class="n">module2_view</span><span class="o">.</span><span class="n">ArrayList</span><span class="p">()</span>
<span class="go">Py4JError: Trying to call a package.</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>As you can see from the previous example, the import of <cite>java.util.ArrayList</cite>
only affects <cite>module1_view</cite>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In fact, the <cite>gateway.jvm</cite> member is also an instance of <a class="reference internal" href="py4j_java_gateway.html#py4j.java_gateway.JVMView" title="py4j.java_gateway.JVMView"><code class="xref py py-class docutils literal notranslate"><span class="pre">JVMView</span></code></a>. It is automatically created when a gateway is
initialized.</p>
</div>
</section>
<section id="using-py4j-with-eclipse">
<span id="eclipse-features"></span><h2><span class="section-number">3.10. </span>Using Py4J with Eclipse<a class="headerlink" href="#using-py4j-with-eclipse" title="Permalink to this headline">¶</a></h2>
<p>Py4J can be used with Eclipse like any normal Java program. A plug-in needs to
instantiate and start a GatewayServer. By default, the GatewayServer will only
be able to access the classes declared in the plug-in or one of its
dependencies.</p>
<p>Unless they have specific needs, users are encouraged to use the Eclipse
plug-ins provided by Py4J available on the following update site:</p>
<p><code class="docutils literal notranslate"><span class="pre">http://eclipse.py4j.org/</span></code></p>
<p>The plug-in <cite>org.py4j.py4j-java</cite> contains the same code as the production jar
published on maven or pypi and it also contains a OSGi MANIFEST.MF. See the
<a class="reference internal" href="install.html#build-instructions"><span class="std std-ref">build instructions</span></a> to build the OSGi bundle
locally.</p>
<p>You can also use legacy plug-ins that will eventually be moved to the new build
process on the following update site:</p>
<p><code class="docutils literal notranslate"><span class="pre">http://eclipse-legacy.py4j.org/</span></code></p>
<p>The first plug-in, <cite>net.sf.py4j</cite>, provides all the Py4J Java classes such as
<cite>GatewayServer</cite>. The plug-in comes with the source and the javadoc. The plug-in
also declares a <cite>global</cite> buddy policy which allows the <cite>GatewayServer</cite> to
access any class declared in any plug-in loaded with Eclipse.</p>
<p>The second plug-in, <cite>net.sf.py4j.defaultserver</cite>, instantiates a GatewayServer
and starts it as soon as Eclipse is started (no lazy loading). The ports used
by the default server can be changed in the Py4J Preferences page. The server
is also accessible at runtime:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">net.sf.py4j.defaultserver.DefaultServerActivator</span><span class="p">;</span>

<span class="p">...</span>

<span class="n">GatewayServer</span> <span class="n">server</span> <span class="o">=</span> <span class="n">DefaultServerActivator</span><span class="p">.</span><span class="na">getDefault</span><span class="p">().</span><span class="na">getServer</span><span class="p">();</span>
</pre></div>
</div>
<p>Here is a short example of what you could do with Py4J and Eclipse:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">py4j.java_gateway</span> <span class="kn">import</span> <span class="n">JavaGateway</span><span class="p">,</span> <span class="n">java_import</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gateway</span> <span class="o">=</span> <span class="n">JavaGateway</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">jvm</span> <span class="o">=</span> <span class="n">gateway</span><span class="o">.</span><span class="n">jvm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">java_import</span><span class="p">(</span><span class="n">jvm</span><span class="p">,</span> <span class="s1">&#39;org.eclipse.core.resources.*&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">workspace_root</span> <span class="o">=</span> <span class="n">jvm</span><span class="o">.</span><span class="n">ResourcesPlugin</span><span class="o">.</span><span class="n">getWorkspace</span><span class="p">()</span><span class="o">.</span><span class="n">getRoot</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gateway</span><span class="o">.</span><span class="n">help</span><span class="p">(</span><span class="n">workspace_root</span><span class="p">,</span><span class="s1">&#39;*Projects*&#39;</span><span class="p">)</span>
<span class="go">Help on class WorkspaceRoot in package org.eclipse.core.internal.resources:</span>

<span class="go">WorkspaceRoot extends org.eclipse.core.internal.resources.Container implements org.eclipse.core.resources.IWorkspaceRoot {</span>
<span class="go">|</span>
<span class="go">|  Methods defined here:</span>
<span class="go">|</span>
<span class="go">|  getProjects() : IProject[]</span>
<span class="go">|</span>
<span class="go">|  getProjects(int) : IProject[]</span>
<span class="go">|</span>
<span class="go">|  ------------------------------------------------------------</span>
<span class="go">|  Fields defined here:</span>
<span class="go">|</span>
<span class="go">|  ------------------------------------------------------------</span>
<span class="go">|  Internal classes defined here:</span>
<span class="go">|</span>
<span class="go">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">project_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">project</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">workspace_root</span><span class="o">.</span><span class="n">getProjects</span><span class="p">()]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">project_names</span><span class="p">)</span>
<span class="go">[u&#39;test2&#39;, u&#39;testplugin&#39;, u&#39;testplugin2&#39;]</span>
</pre></div>
</div>
<p>Support for Eclipse was introduced in Py4J 0.5 and more features may be added
in the future.</p>
</section>
<section id="listening-to-server-events">
<h2><span class="section-number">3.11. </span>Listening to server events<a class="headerlink" href="#listening-to-server-events" title="Permalink to this headline">¶</a></h2>
<p>On the Java side, it is possible to listen to GatewayServer events by
registering an instance of <code class="docutils literal notranslate"><span class="pre">py4j.GatewayServerListener</span></code> with
<code class="docutils literal notranslate"><span class="pre">GatewayServer.addListener</span></code>.</p>
<p>On the Python side, it is possible to listen to CallbackServer events using
signals. Recognizing that signals may be a foreign concept to Java developers,
here is a full example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">py4j.java_gateway</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">server_connection_started</span><span class="p">,</span> <span class="n">server_connection_stopped</span><span class="p">,</span>
    <span class="n">server_started</span><span class="p">,</span> <span class="n">server_stopped</span><span class="p">,</span> <span class="n">pre_server_shutdown</span><span class="p">,</span> <span class="n">post_server_shutdown</span><span class="p">,</span>
    <span class="n">JavaGateway</span><span class="p">,</span> <span class="n">GatewayParameters</span><span class="p">,</span> <span class="n">CallbackServerParameters</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">started</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">]</span>
    <span class="c1"># do something</span>

<span class="k">def</span> <span class="nf">connection_started</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;connection&quot;</span><span class="p">]</span>
    <span class="c1"># do something</span>

<span class="k">def</span> <span class="nf">connection_stopped</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;connection&quot;</span><span class="p">]</span>
    <span class="c1"># do something</span>

<span class="k">def</span> <span class="nf">stopped</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">]</span>
    <span class="c1"># do something</span>

<span class="k">def</span> <span class="nf">pre_shutdown</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">]</span>
    <span class="c1"># do something</span>

<span class="k">def</span> <span class="nf">post_shutdown</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">]</span>
    <span class="c1"># do something</span>

<span class="c1"># Because the server is created and started at the same time,</span>
<span class="c1"># you must listen to all started signals. You will receive the server</span>
<span class="c1"># instance that was started as a parameter and sender.</span>
<span class="n">server_started</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">started</span><span class="p">)</span>
<span class="n">gateway</span> <span class="o">=</span> <span class="n">JavaGateway</span><span class="p">(</span>
    <span class="n">gateway_parameters</span><span class="o">=</span><span class="n">GatewayParameters</span><span class="p">(),</span>
    <span class="n">callback_server_parameters</span><span class="o">=</span><span class="n">CallbackServerParameters</span><span class="p">())</span>
<span class="n">server_stopped</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">stopped</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">gateway</span><span class="o">.</span><span class="n">get_callback_server</span><span class="p">())</span>
<span class="n">server_connection_started</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">connection_started</span><span class="p">,</span>
    <span class="n">sender</span><span class="o">=</span><span class="n">gateway</span><span class="o">.</span><span class="n">get_callback_server</span><span class="p">())</span>
<span class="n">server_connection_stopped</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">connection_stopped</span><span class="p">,</span>
    <span class="n">sender</span><span class="o">=</span><span class="n">gateway</span><span class="o">.</span><span class="n">get_callback_server</span><span class="p">())</span>
<span class="n">pre_server_shutdown</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">pre_shutdown</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">gateway</span><span class="o">.</span><span class="n">get_callback_server</span><span class="p">())</span>
<span class="n">post_server_shutdown</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">post_shutdown</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="n">gateway</span><span class="o">.</span><span class="n">get_callback_server</span><span class="p">())</span>
</pre></div>
</div>
<p>You can read more information about the <a class="reference internal" href="py4j_signals.html#module-py4j.signals" title="py4j.signals: Basic signals implementation (listeners/events/observers)."><code class="xref py py-mod docutils literal notranslate"><span class="pre">signals</span></code></a> module or
the <a class="reference internal" href="py4j_java_gateway.html#api-signals"><span class="std std-ref">Py4J signals</span></a>.</p>
</section>
<section id="py4j-memory-model">
<span id="adv-memory"></span><h2><span class="section-number">3.12. </span>Py4J Memory model<a class="headerlink" href="#py4j-memory-model" title="Permalink to this headline">¶</a></h2>
<p><strong>Java objects sent to the Python side</strong></p>
<p>Every time a Java object is sent to the Python side, a reference to the object
is kept on the Java side (in the Gateway class). Once the object is garbage
collected on the Python VM (reference count == 0), the reference is removed on
the Java VM: if this was the last reference, the object will likely be garbage
collected too. When a gateway is shut down, the remaining references are also
removed on the Java VM.</p>
<p>Because Java objects on the Python side are involved in a circular reference
(<code class="xref py py-class docutils literal notranslate"><span class="pre">JavaObject</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">JavaMember</span></code> reference each other), these objects are not
immediately garbage collected once the last reference to the object is removed
(but they are guaranteed to be eventually collected <strong>if the Python garbage
collector runs before the Python program exits</strong>).</p>
<p>In doubt, users can always call the <a class="reference internal" href="py4j_java_gateway.html#py4j.java_gateway.JavaGateway.detach" title="py4j.java_gateway.JavaGateway.detach"><code class="xref py py-func docutils literal notranslate"><span class="pre">detach</span></code></a> function on the Python gateway to
explicitly delete a reference on the Java side. A call to <cite>gc.collect()</cite> also
usually works.</p>
<p><strong>Python objects sent to the Java side (callback)</strong></p>
<p>Every time a Python object is sent to the Java side, a reference to this object
is kept on the Python side (by a <code class="xref py py-class docutils literal notranslate"><span class="pre">PythonProxyPool</span></code>). Once a python object is garbage
collected on the Java side, a message is sent to the Python side to remove the
reference to the Python object. When a gateway is shut down, the remaining
references are removed from the Python VM.</p>
<p>Unfortunately, there is no guarantee that the garbage collection message will
ever be sent to the Python side (it usually works on Sun/Oracle VM). It might
thus be necessary to manually remove the reference to the Python objects. Some
helper functions will be developed in the future, but it is unlikely that
garbage collection will be guarenteed because of the specifications of Java
finalizers (which are surprisingly worse than Python finalizer strategies).</p>
</section>
<section id="py4j-threading-and-connection-model">
<span id="adv-threading"></span><h2><span class="section-number">3.13. </span>Py4J Threading and connection model<a class="headerlink" href="#py4j-threading-and-connection-model" title="Permalink to this headline">¶</a></h2>
<p>In its default mode, Py4J allocates one thread per connection. The design of
Py4j is symmetrical on the Python and Java sides. A Python GatewayClient
communicates with the Java GatewayServer and is then associated with a
GatewayConnection. A Java CallbackClient (for callbacks) communicates with the
Python CallbackServer and is then associated with a CallbackConnection. A
connection runs in the calling thread.</p>
<p>And now, for the details:</p>
<p><strong>On the Python side: calling Java</strong></p>
<p>Py4J on the Python side does not explicitly create a thread to call Java
methods. When a method is called, a connection to the Java GatewayServer is
established in the calling thread. If multiple threads are calling Java methods
concurrently, Py4J will ensure that each thread has its own connection by
requesting more connections.</p>
<p>To be extra clear: if you only call Java, Py4J on the Python side will never
create a thread.</p>
<p>To be extra extra clear: Py4J is thread-safe so if you use a JavaGateway from
multiple threads that <strong>you created</strong>, Py4J will make manage the network
resources appropriately.</p>
<p><strong>On the Python side: receiving callbacks from Java</strong></p>
<p>Py4J explicitly creates a thread to run the
<a class="reference internal" href="py4j_java_gateway.html#py4j.java_gateway.CallbackServer" title="py4j.java_gateway.CallbackServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">CallbackServer</span></code></a>, which accepts
callback connection requests, and a thread for each callback connection
request. As long as there is no concurrent callback from the Java side, the
same callback connection/thread will be used.</p>
<p>These threads are necessary to prevent deadlocks. For example, if we only had a
single thread to handle callbacks from Java, Py4J would deadlock as soon as it
would encounter an indirect recursion between Java and Python functions. Early
versions of Py4J made this mistake :-)</p>
<p><strong>On the Java side: receiving calls from Python</strong></p>
<p>Py4J explicitly creates a thread to run the GatewayServer, which accepts
connection requests (from a GatewayClient), and a thread for each connection
request. As long as there is no concurrent call from the Python side, the same
connection/thread will be used.</p>
<p><strong>On the Java side: calling back Python</strong></p>
<p>Py4J on the Java side does not explicitly create a thread to make a callback to
a Python object. When a callback is called, a connection to the CallbackServer
is established in the calling thread. If <strong>you created</strong> multiple threads in
Java to call back Python concurrently, Py4J will ensure that each thread has
its own CallbackConnection.</p>
<p><strong>Alternative threading model</strong></p>
<p>If both sides are making multiple calls to each other (e.g., indirect
recursion), or if you want to control which thread will execute the calls, you
should use the <a class="reference internal" href="#clientserver"><span class="std std-ref">single threading model</span></a>, which provide a
more efficient threading model.</p>
</section>
<section id="tls">
<span id="security"></span><h2><span class="section-number">3.14. </span>TLS<a class="headerlink" href="#tls" title="Permalink to this headline">¶</a></h2>
<p>Py4J supports TLS for both connections from Python to the JVM and the callback
connections to Python. This requires configuring both Java and Python:</p>
<p><strong>On the Python side</strong></p>
<p>Use Python’s <cite>ssl</cite> module to create an <cite>ssl.SSLContext</cite>.  For the connection to
the JVM you’ll need something like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">client_ssl_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLContext</span><span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">PROTOCOL_TLSv1</span><span class="p">)</span>
<span class="n">client_ssl_context</span><span class="o">.</span><span class="n">verify_mode</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CERT_REQUIRED</span>
<span class="n">client_ssl_context</span><span class="o">.</span><span class="n">check_hostname</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">client_ssl_context</span><span class="o">.</span><span class="n">load_verify_locations</span><span class="p">(</span><span class="n">cafile</span><span class="o">=</span><span class="s1">&#39;/path/to/pem/ca/certs&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This <cite>ssl.SSLContext</cite> should be set as the <cite>ssl_context</cite> parameter when
constructing an instanceof of <cite>GatewayParameters</cite>. If you’re setting
<cite>check_hostname</cite> to <cite>True</cite> like the code above then the <cite>address</cite> parameter
of the <cite>GatewayParameters</cite> must match (one of) the hostnames in the certificate
the Java <cite>GatewayServer</cite> presents.</p>
<p>For the socket listening for callbacks from the JVM, you’ll need something
like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">server_ssl_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">SSLContext</span><span class="p">(</span><span class="n">ssl</span><span class="o">.</span><span class="n">PROTOCOL_TLSv1</span><span class="p">)</span>
<span class="n">server_ssl_context</span><span class="o">.</span><span class="n">load_cert_chain</span><span class="p">(</span>
  <span class="s1">&#39;/path/to/pem/private/key&#39;</span><span class="p">,</span>
  <span class="n">password</span><span class="o">=</span><span class="s1">&#39;key-password&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This <cite>ssl.SSLContext</cite> should be set as the <cite>ssl_context</cite> parameter when
constructing an instance of <cite>CallbackServerParameters</cite>. You can see a full
example in the test file <cite>py4j-python/src/tests/java_tls_test.py</cite>.</p>
<p><strong>On the Java side</strong></p>
<p>Use the <cite>GatewayServer</cite> constructor that takes a <cite>ServerSocketFactory</cite>, and
pass an instance of type <cite>SSLServerSocketFactory</cite>. The easiest way of
constructing one of these is using <cite>SSLServerSocketFactory.getDefault()</cite>,
however for more control construct a <cite>SSLContext</cite>.</p>
<p>To add TLS to callbacks, create a <cite>CallbackClient</cite> with the constructor that
takes a <cite>SSLSocketFactory</cite>. You can get an instance of this via <cite>getDefault()</cite>
or a <cite>SSLContext</cite> instance similarly.</p>
<p>A runnable example is in <cite>py4j.examples.ExampleSSLApplication</cite>.</p>
</section>
<section id="authentication">
<h2><span class="section-number">3.15. </span>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h2>
<p>By default, Py4J does not authenticate client connections. This allows any
user who can open a connection to the Py4J daemons to potentially execute
code as the user running those daemons.</p>
<p>Authentication can be enabled by providing an authentication token to the
different servers. See the API documentation for how to provide the
authentication token through the API.</p>
<p>Py4J leaves it to the application to generate and distribute the authentication
tokens to all the needed processes.</p>
<p>The authentication protocol transfers the token over the socket connection,
so it relies on transport-level encryption for secrecy. This means that for
proper security, connections should use loopback addresses, or use TLS.</p>
<p>Here is a quick example of how to use an authentication token.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">GatewayServer</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GatewayServer</span><span class="p">.</span><span class="na">GatewayServerBuilder</span><span class="p">().</span><span class="na">entryPoint</span><span class="p">(</span>
  <span class="k">new</span> <span class="n">ExampleEntryPoint</span><span class="p">()).</span><span class="na">authToken</span><span class="p">(</span><span class="s">&quot;HelloWorld&quot;</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
<span class="n">server</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">py4j.java_gateway</span> <span class="kn">import</span> <span class="n">JavaGateway</span><span class="p">,</span> <span class="n">GatewayParameters</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">GatewayParameters</span><span class="p">(</span><span class="n">auth_token</span><span class="o">=</span><span class="s2">&quot;HelloWorld&quot;</span><span class="p">)</span>
<span class="n">gateway</span> <span class="o">=</span> <span class="n">JavaGateway</span><span class="p">(</span><span class="n">gateway_parameters</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="boxing">
<h2><span class="section-number">3.16. </span>Boxing<a class="headerlink" href="#boxing" title="Permalink to this headline">¶</a></h2>
<p>Boxed Java primitives, such as <cite>java.lang.Integer</cite> are unboxed in the JVM and
transmitted as primitives, so they will appear as Python <cite>int</cite> and not
<cite>JavaObjects</cite>.</p>
</section>
<section id="performance">
<h2><span class="section-number">3.17. </span>Performance<a class="headerlink" href="#performance" title="Permalink to this headline">¶</a></h2>
<p>We track performance with each new release by running a <a class="reference external" href="https://github.com/bartdag/py4j-benchmark">benchmark suite</a> that tests various features of
Py4J.</p>
<p>The benchmark data and performance evolution charts are made <a class="reference external" href="https://docs.google.com/spreadsheets/d/14ljMYIESFbOBFe4o_Fy6WirI2P5iCQuTP9fA1BuLMAI/edit?usp=sharing">available as google charts</a>.</p>
<p>The following chart illustrates the progress Py4J made so far for transferring
1 MB byte arrays.</p>
<iframe width="600" height="371" seamless frameborder="0" scrolling="no"
src="https://docs.google.com/spreadsheets/d/14ljMYIESFbOBFe4o_Fy6WirI2P5iCQuTP9fA1BuLMAI/pubchart?oid=935988429&amp;format=interactive"></iframe></section>
</section>


          </div>
		  		
				<div class="helpbar">
					<h3>Questions/Feedback?</h3>
					<ul>
						<li>Try the <a href="faq.html">FAQ</a> -- It answers many questions.</li>
						<li>Search for information in the <a href="https://groups.google.com/a/py4j.org/forum/#!forum/py4j">archives of the py4j-users mailing list</a>, or <a href="https://groups.google.com/a/py4j.org/forum/#!forum/py4j/join">post a question</a>.</li>
						<li>If you notice errors with this documentation, <a href="https://github.com/bartdag/py4j/issues">open a ticket</a> and let us know. Please, only open a ticket for feedback or improvements on the docs. To get help, use the links above!</li>
					</ul>
				</div>
				
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 5px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="py4j_python.html" title="4. Py4J Python API"
             >next</a> |</li>
        <li class="right" >
          <a href="getting_started.html" title="2. Getting Started with Py4J"
             >previous</a> |</li>
    <li><a href="index.html">Home</a> |</li>
	<li><a href="download.html">Download</a> |</li>
	<li><a href="contents.html">Doc</a> |</li>
	<li><a href="https://blog.py4j.org">Blog</a> |</li>
	<li><a href="https://github.com/bartdag/py4j">github</a> |</li>
	<li><a href="about.html">About</a> &raquo;</li>
 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2009-2015, Barthélémy Dagenais.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 4.4.0.
    </div>
  </div>
  </body>


</html>